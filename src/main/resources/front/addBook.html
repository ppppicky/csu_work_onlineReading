<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>添加书籍</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            width: 500px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            font-size: 14px;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .input-group textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            height: 80px;
        }
        .btn {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .success {
            color: green;
            font-size: 14px;
        }
        .error {
            color: red;
            font-size: 14px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>添加书籍</h2>
    <div class="input-group">
        <label for="bookName">书名</label>
        <input type="text" id="bookName" placeholder="请输入书名" required>
    </div>
    <div class="input-group">
        <label for="author">作者</label>
        <input type="text" id="author" placeholder="请输入作者" required>
    </div>
    <div class="input-group">
        <label for="bookCover">封面图片链接</label>
        <input type="text" id="bookCover" placeholder="请输入封面图片链接（可选）">
    </div>
    <div class="input-group">
        <label for="bookPage">页数</label>
        <input type="number" id="bookPage" placeholder="请输入页数" required>
    </div>
    <div class="input-group">
        <label for="epubFile">上传电子书（epub文件）</label>
        <input type="file" id="epubFile" accept=".epub" required>
    </div>
    <div class="input-group">
        <label for="isCharge">是否收费</label>
        <select id="isCharge">
            <option value="0">免费</option>
            <option value="1">收费</option>
        </select>
    </div>
    <div class="input-group">
        <label for="bookTypeId">书籍类型</label>
        <input type="number" id="bookTypeId" placeholder="请输入书籍类型ID" required>
    </div>
    <button class="btn" onclick="addBook()">添加书籍</button>
    <div class="success" id="success-message"></div>
    <div class="error" id="error-message"></div>
</div>

<script>
    function addBook() {
        const bookName = document.getElementById("bookName").value;
        const author = document.getElementById("author").value;
        const bookCover = document.getElementById("bookCover").value;
        const bookPage = document.getElementById("bookPage").value;
        const epubFile = document.getElementById("epubFile").files[0];
        const isCharge = document.getElementById("isCharge").value;
        const bookTypeId = document.getElementById("bookTypeId").value;

        const errorMessage = document.getElementById("error-message");
        const successMessage = document.getElementById("success-message");

        // 清除错误和成功信息
        errorMessage.textContent = '';
        successMessage.textContent = '';

        // 输入验证
        if (!bookName || !author || !bookPage || !epubFile || !bookTypeId) {
            errorMessage.textContent = "请填写所有必填项!";
            return;
        }

        const formData = new FormData();
        formData.append("bookName", bookName);
        formData.append("author", author);
        formData.append("bookCover", bookCover);
        formData.append("bookPage", bookPage);
        formData.append("epubFile", epubFile);
        formData.append("isCharge", isCharge);
        formData.append("bookTypeId", bookTypeId);
        formData.append("createTime", new Date().toISOString()); // 当前时间

        // 使用Fetch API发送POST请求
        fetch('/manager/addBook', {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            if (data.message === '书籍添加成功') {
                successMessage.textContent = '书籍添加成功！';
            } else {
                errorMessage.textContent = data.message;
            }
        })
        .catch(error => {
            errorMessage.textContent = "添加书籍失败，请重试!";
            console.error(error);
        });
    }
</script>

</body>
</html>
